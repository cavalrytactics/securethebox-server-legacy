branches:
  only:
  - master
  - testing-00001

matrix:
  include:
    - language: python
      os: linux
      python: 3.7
      install:
        - pip install -r requirements.txt
      script:
        - pytest tests/test_gitlab_controller.py

    - language: python
      os: linux
      python: 3.7
      env:
        global: 
          - CLOUDSDK_CORE_DISABLE_PROMPTS=1 
          - CLOUDSDK_INSTALL_DIR = $HOME/google-cloud-sdk
      cache:
        directories: $HOME/google-cloud-sdk
      services: 
        - docker
      before_install:
        - echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] http://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
        - curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
        - sudo apt-get update -y 
        - sudo apt-get install google-cloud-sdk -y
        # - nohup bash install_gcloud.sh &
        # - for i in $(seq 1 10); do sleep 60; echo $i; done
        - gcloud components install kubectl
      install: true
      script: 
        - gcloud version
        - kubectl version
        - pytest tests/test_kubernetes_controller.py
# Add the Cloud SDK distribution URI as a package source


# Import the Google Cloud Platform public key


# Update the package list and install the Cloud SDK
sudo apt-get update && sudo apt-get install google-cloud-sdk